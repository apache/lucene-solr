<?xml version="1.0"?>

<project name="SearchBean" default="jar" basedir=".">

    <!-- Give user a chance to override without editing this file
        (and without typing -D each time it compiles it -->
  <property file="${user.home}/lucene.build.properties" /> 
  <property file="${user.home}/build.properties" />
  <property file="${basedir}/build.properties" />
  <property file="${basedir}/default.properties" />

  <!-- Build classpath -->
  <path id="classpath">
    <pathelement location="${build.classes}"/>
    <pathelement location="${build.test.classes}"/>
    <pathelement location="."/>
    <fileset dir="lib">
      <include name="*.jar" />
    </fileset>
  </path>

  <path id="junit.classpath">
    <pathelement location="${junit.classes}" />
    <pathelement location="${build.classes}"/>
    <fileset dir="lib">
      <include name="*.jar" />
    </fileset>
    <pathelement path="${java.class.path}" />
  </path>

  <!-- ================================================================== -->
  <!-- Prepares the build directory                                       -->
  <!-- ================================================================== -->
  <target name="init">
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.classes}"/>
    <mkdir dir="${build.src}"/>
    
    <available
      property="junit.present"
      classname="org.apache.tools.ant.taskdefs.optional.junit.JUnitTask"
    />
  </target>



  <!-- ================================================================== -->
  <!-- C O M P I L E                                                      -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="compile" depends="init" >

    <javac
      encoding="${build.encoding}"
      srcdir="${src.dir}"
      includes="org/**/*.java"
      destdir="${build.classes}"
      debug="${debug}">
      <classpath refid="classpath"/>
    </javac>
  </target>

  <!-- ================================================================== -->
  <!-- J A R                                                              -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="jar" depends="compile" >
    <jar
      jarfile="${build.dir}/${final.name}.jar"
      basedir="${build.classes}"
      excludes="**/*.java"
    />
  </target>


  <!-- ================================================================== -->
  <!-- J A R  S O U R C E                                                 -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="jar-src" depends="init">
    <jar jarfile="${build.dir}/${final.name}-src.jar">
      <fileset dir="${build.dir}" includes="**/*.java"/>
    </jar>
  </target>


  <!-- ================================================================== -->
  <!-- B U I L D  T E S T                                                 -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="test" depends="compile">
    <mkdir dir="${build.test}"/>

    <copy todir="${build.test.src}">
      <fileset dir="${test.src}">
        <include name="**/*.java"/>
      </fileset>
    </copy>

    <mkdir dir="${build.test.classes}"/>

    <javac
      encoding="${build.encoding}"
      srcdir="${build.test.src}"
      includes="**/*.java"
      destdir="${build.test.classes}"
      debug="${debug}">
      <classpath refid="classpath"/>
    </javac>
  </target>

  <!-- ================================================================== -->
  <!-- R U N  T E S T S                                                   -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="test-unit" depends="compile,test" if="junit.present">
    <!-- Import JUnit task -->
    <taskdef
      name="junit"
      classname="org.apache.tools.ant.taskdefs.optional.junit.JUnitTask"
    />

    <mkdir dir="${junit.classes}"/>
    <mkdir dir="${junit.reports}"/>
    <javac
      encoding="${build.encoding}"
      srcdir="${junit.src}"
      includes="**/*.java"
      destdir="${junit.classes}"
      debug="${debug}">
      <classpath refid="classpath"/>
    </javac>

    <junit printsummary="yes" haltonfailure="no" >
      <classpath refid="junit.classpath"/>
      <formatter type="plain" />
      <batchtest fork="yes" todir="${junit.reports}">
        <fileset dir="${junit.src}" includes="**/Test*.java" />
      </batchtest>
    </junit>
  </target>

  <!-- ================================================================== -->
  <!-- J A V A D O C                                                      -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="javadocs" depends="compile" >
    <mkdir dir="${build.javadocs}"/>
    <javadoc
      sourcepath="${src.dir}"
      overview="${src.dir}/overview.html"
      packagenames="${packages}"
      destdir="${build.javadocs}"
      author="true"
      version="true"
      use="true"
      link="${javadoc.link}"
      windowtitle="${Name} ${version} API"
      doctitle="${Name} ${version} API"
      bottom="Copyright &amp;copy; ${year} Apache Software Foundation.  All Rights Reserved."
      >
      <classpath refid="classpath"/>
    </javadoc>
  </target>

  <!-- ================================================================== -->
  <!-- D I S T R I B U T I O N                                            -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="package" depends="jar, javadocs">
    <mkdir dir="${dist.dir}"/>
    <mkdir dir="${dist.dir}/docs"/>
    <mkdir dir="${dist.dir}/docs/api"/>
    <mkdir dir="${dist.dir}/src/jsp"/>

    <copy todir="${dist.dir}/docs">
      <fileset dir="${docs.dir}"/>
    </copy>
    <copy todir="${dist.dir}/docs/api">
      <fileset dir="${build.javadocs}"/>
    </copy>

    <copy todir="${dist.dir}/src/jsp">
      <fileset dir="src/jsp"/>
    </copy>
    <copy todir="${dist.dir}/lib">
      <fileset dir="lib"/>
    </copy>
    <copy todir="${dist.dir}">
      <fileset dir=".">
        <include name="*.txt" />
      </fileset>
    </copy>
    <copy file="${build.dir}/${final.name}.jar" todir="${dist.dir}"/>
  </target>

  <!-- ================================================================== -->
  <!-- Packages the distribution with zip                                 -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="package-zip" depends="package"
	  description="--> Generates the SearchBean distribution as .zip">

    <delete file="${basedir}/${final.name}.zip"/>
    <zip
      zipfile="${basedir}/${final.name}.zip"
      basedir="${basedir}/"
      includes="**/${final.name}/**"
    />
  </target>

  <!-- ================================================================== -->
  <!-- packages the distribution with tar-gzip                            -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="package-tgz" depends="package"
    description="--> generates the SearchBean distribution as .tar.gz">

    <delete file="${basedir}/${final.name}.tar"/>
    <delete file="${basedir}/${final.name}.tar.gz"/>
    <tar
      tarfile="${basedir}/${final.name}.tar"
      basedir="${basedir}/"
      includes="**/${final.name}/**"
    />

    <gzip
      zipfile="${basedir}/${final.name}.tar.gz"
      src="${basedir}/${final.name}.tar"
    />
  </target>

  <!-- ================================================================== -->
  <!-- packages the distribution with zip and tar-gzip                    -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="package-all" depends="package-zip, package-tgz"
    description="--> generates the .tar.gz and .zip distributions">
  </target>

  <!-- ================================================================== -->
  <!-- same as package-all. it is just here for compatibility.            -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="dist" depends="package-all">
  </target>

  <!-- ================================================================== -->
  <!-- S O U R C E  D I S T R I B U T I O N                               -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="package-src" depends="jar-src">
    <mkdir dir="${dist-src.dir}"/>
    <copy todir="${dist-src.dir}/src">
      <fileset dir="src"/>
    </copy>
    <copy todir="${dist-src.dir}/lib">
      <fileset dir="lib"/>
    </copy>
    <copy todir="${dist-src.dir}/" file="build.xml"/>
    <copy todir="${dist-src.dir}/" file="default.properties"/>
    <copy todir="${dist-src.dir}">
      <fileset dir=".">
        <include name="*.txt" />
      </fileset>
    </copy>
    <copy file="${build.dir}/${final.name}-src.jar" todir="${dist-src.dir}"/>
  </target>

  <!-- ================================================================== -->
  <!-- Packages the sources with zip                                      -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="package-zip-src" depends="package-src"
	  description="--> Generates the SearchBean sources as .zip">

    <delete file="${basedir}/${final.name}-src.zip"/>
    <zip
      zipfile="${basedir}/${final.name}-src.zip"
      basedir="${basedir}/"
      includes="**/${final.name}-src/**"
    />
  </target>

  <!-- ================================================================== -->
  <!-- Packages the sources with tar-gzip                                 -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="package-tgz-src" depends="package-src"
	  description="--> Generates the SearchBean distribution as .tar.gz">

    <delete file="${basedir}/${final.name}-src.tar"/>
    <delete file="${basedir}/${final.name}-src.tar.gz"/>
    <tar
      tarfile="${basedir}/${final.name}-src.tar"
      basedir="${basedir}/"
      includes="**/${final.name}-src/**"
    />

    <gzip
      zipfile="${basedir}/${final.name}-src.tar.gz"
      src="${basedir}/${final.name}-src.tar"
    />
  </target>

  <!-- ================================================================== -->
  <!-- Packages the sources with zip and tar-gzip                         -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="package-all-src" depends="package-zip-src, package-tgz-src"
    description="--> Generates the .tar.gz and .zip source distributions">
  </target>

  <!-- ================================================================== -->
  <!-- same as package-all-src. it is just here for compatibility.        -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="dist-src" depends="package-all-src">
  </target>

  <!-- ================================================================== -->
  <!-- C L E A N                                                          -->
  <!-- ================================================================== -->
  <!--                                                                    -->
  <!-- ================================================================== -->
  <target name="clean" depends="init">
    <delete dir="${build.dir}"/>
    <delete dir="${dist.dir}"/>
    <delete file="${basedir}/${final.name}.tar"/>
    <delete file="${basedir}/${final.name}.tar.gz"/>
    <delete file="${basedir}/${final.name}.zip"/>
    <delete dir="${dist.dir}-src"/>
    <delete file="${basedir}/${final.name}-src.tar"/>
    <delete file="${basedir}/${final.name}-src.tar.gz"/>
    <delete file="${basedir}/${final.name}-src.zip"/>
  </target>



  <!-- ================================================================== -->
  <!-- Build the DocWeb app                                               -->
  <!-- ================================================================== -->
  <target name="docweb-init">
<!--    <mkdir dir="${}"/> -->
  </target>

  <!--
  <target name="docweb-index" depends="javadocs,anttask-compile,docweb-init">
    <taskdef name="index"
             classname="org.apache.lucene.ant.IndexTask">
      <classpath>
        <pathelement location="${anttask.classes}"/>
        <path refid="classpath"/>
      </classpath>
    </taskdef>

    <index index="${build.docweb}/index"
           overwrite="false">
      <fileset dir="${docs.dir}"/>
      <fileset dir="${build.javadocs}"/>
    </index>

  </target>

  <target name="docweb-war" depends="jar,jardemo,docweb-index">
    <war warfile="${build.docweb}/${build.docweb.war.name}.war"
         webxml="${demo.jsp}/WEB-INF/web.xml">
      <fileset dir="${demo.jsp}" excludes="WEB-INF/"/>
      <lib dir="${build.demo}" includes="*.jar"/>
      <lib dir="${build.dir}" includes="*.jar"/>
      <webinf dir="${build.docweb}" includes="index/"/>
    </war>
  </target>
  -->
</project>
