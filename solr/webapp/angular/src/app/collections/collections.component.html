<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<div id="collections" class="clearfix empty">
  <!--div id="ui-block" style="display:none">&nbsp;</div> @todo what is this for? -->
  <div id="frame">
    <div id="actions" class="actions clearfix">
      <button id="add" class="action" (click)="showAddCollection()"><span>Add Collection</span></button>
      <button id="delete" class="warn requires-core" (click)="showDeleteCollection()" *ngIf="collection"><span>Delete</span></button>
      <button id="reload" class="requires-core" (click)="reloadCollection()" *ngIf="collection" [ngClass]="{'success': reloadSuccess, 'warn': reloadFailure}"><span>Reload</span></button>
      <button id="create-alias" class="action requires-core" (click)="toggleCreateAlias()"><span>Create Alias</span></button>
      <button id="delete-alias" class="action requires-core" (click)="toggleDeleteAlias()"><span>Delete Alias</span></button>

      <div class="action add" data-rel="add" *ngIf="showAdd" style="left:0px">
        <form>
          <p class="clearfix"><label for="add_name">name:</label>
          <input type="text" name="name" id="add_name" [(ngModel)]="newCollection.name" placeholder="new collection"></p>
          <p class="clearfix">
            <label for="add_config">config set:</label>&nbsp;
            <ng-select name="config_name" id="add_config" [(ngModel)]="newCollection.configName" [items]="configs" placeholder="Select an Option"></ng-select>
          </p>
          <p class="clearfix"><label for="add_numShards">numShards:</label>
          <input type="text" name="numShards" id="add_numShards" [(ngModel)]="newCollection.numShards"></p>
          <p class="clearfix"><label for="add_replicationFactor">replicationFactor:</label>
          <input type="text" name="replicationFactor" id="add_replicationFactor" [(ngModel)]="newCollection.replicationFactor"></p>
          <p class="clearfix"><a (click)="showAdvanced =! showAdvanced">
              <span id="add_advanced" [ngClass]="{'open': showAdvanced}">Show advanced</span></a></p>
          <div *ngIf="showAdvanced">
              <p>Advanced options: </p>
              <p class="clearfix"><label for="add_router_name">router:</label>
              <select name="routerName" id="add_router_name" [(ngModel)]="newCollection.routerName">
                <option value="compositeId">Composite ID</option>
                <option value="implicit">Implicit</option>
              </select>
              </p>
              <p class="clearfix"><label for="add_maxShardsPerNode">maxShardsPerNode:</label>
              <input type="text" name="replicationFactor" id="add_maxShardsPerNode" [(ngModel)]="newCollection.maxShardsPerNode"></p>
              <p class="clearfix"><label for="add_shards">shards:</label>
              <input type="text" name="shards" id="add_shards" [(ngModel)]="newCollection.shards"></p>
              <p class="clearfix"><label for="add_routerField">router.field:</label>
              <input type="text" name="routerField" id="add_routerField" [(ngModel)]="newCollection.routerField"></p>
              <p class="clearfix"><label for="add_autoAddReplicas">autoAddReplicas:</label>
                <select name="autoAddReplicas" id="add_autoAddReplicas" [(ngModel)]="newCollection.autoAddReplicas">
                  <option value="true">true</option>
                  <option value="false">false</option>
                </select>
              </p>
          </div>
          <p class="clearfix note error" *ngIf="addMessage">
            <span>{{addMessage}}</span>
          </p>
          <p class="clearfix buttons">
            <button type="button" class="submit" (click)="addCollection()"><span>Add Collection</span></button>
            <button type="reset" class="reset" (click)="cancelAddCollection()"><span>Cancel</span></button>
          </p>

        </form>

      </div>

      <div class="action delete" *ngIf="showDelete">
        <form>
          <p>Please type collection name to confirm deletion:</p>
          <p class="clearfix"><label for="collectiondeleteConfirm">Collection</label>
          <input type="text" [(ngModel)]="collectionDeleteConfirm" id="collectionDeleteConfirm"></p>
          <p class="clearfix note error" *ngIf="deleteMessage">
            <span>{{deleteMessage}}</span>
          </p>
          <p class="clearfix buttons">
            <button class="submit" (click)="deleteCollection()"><span>Delete</span></button>
            <button type="reset" class="reset" (click)="hideDeleteCollection()"><span>Cancel</span></button>
          </p>
        </form>
      </div>

      <div class="action create-alias" *ngIf="showCreateAlias">
        <form>
          <input type="hidden" name="core" data-core="current">
          <p class="clearfix"><label for="alias">Alias Name:</label>
          <input type="text" name="alias" [(ngModel)]="aliasToCreate" id="alias"></p>
          <p class="clearfix"><label for="aliasCollections">Collections:</label>
          <select multiple id="aliasCollections" (ngModel)="aliasCollections" class="other">
          	<option *ngFor="let collectionName of sharedService.collections">{{collectionName}}</option>
          </select></p>

          <p class="clearfix note error" *ngIf="renameMessage">
            <span>{{renameMessage}}</span>
          </p>
          <p class="clearfix buttons">
            <button class="submit" (click)="createAlias()"><span>Create Alias</span></button>
            <button type="reset" class="reset" (click)="cancelCreateAlias()"><span>Cancel</span></button>
          </p>
        </form>
      </div>

      <div class="action delete-alias" *ngIf="showDeleteAlias">
        <form>
          <span *ngIf="aliases">
          <p class="clearfix"><label for="deleteAlias">Alias:</label>
          <select id="deleteAlias" (ngModel)="aliasToDelete" class="other">
          	<option *ngFor="let alias of aliases">{{alias}}</option>
          </select></p>
          <p class="clearfix note error" *ngIf="swapMessage">
            <span>{{swapMessage}}</span>
          </p>
          <p class="clearfix buttons">
            <button type="button" class="submit" (click)="deleteAlias()"><span>Delete Alias</span></button>
            <button type="reset" class="reset" (click)="cancelDeleteAlias()"><span>Cancel</span></button>
          </p>
          </span>
          <span *ngIf="!aliases">
              <p>No aliases to delete.</p>
          <p class="clearfix buttons">
            <button type="reset" class="reset" (click)="cancelDeleteAlias()"><span>Cancel</span></button>
          </p>
          </span>
        </form>
      </div>
    </div>


    <div class="requires-core" *ngIf="!collection">
      <h2>Please select a collection</h2>
    </div>

    <div id="data" class="requires-core clearfix" *ngIf="collection">

      <div class="block" id="collection-data">
          <h2>Collection: {{collection.name}}</h2>
          <div class="message-container">
              <div class="message"></div>
          </div>
          <div class="content">
          <ul>
            <li>
                <dl class="clearfix">
                    <dt><span>Shard count:</span></dt>
                    <dd>{{collection.numShards}}</dd>
                </dl>
            </li>
            <li><dl class="clearfix">
              <dt><span>configName:</span></dt>
                <dd>{{collection.configName}}</dd>
            </dl></li>
            <li><dl class="clearfix">
              <dt><span>replicationFactor:</span></dt>
                <dd>{{collection.replicationFactor}}</dd>
            </dl></li>
            <li><dl class="clearfix">
              <dt><span>maxShardsPerNode:</span></dt>
                <dd>{{collection.maxShardsPerNode}}</dd>
            </dl></li>
            <li><dl class="clearfix">
              <dt><span>router:</span></dt>
                <dd>{{collection.routerName}}</dd>
            </dl></li>
            <li><dl class="clearfix">
              <dt><span>autoAddReplicas:</span></dt>
                <dd>{{collection.autoAddReplicas}}</dd>
            </dl></li>
          </ul>

        </div>
      </div>

      <div class="block" id="shard-data">
        <div class="content shard" *ngFor="let shard of collection.shards">
          <a (click)="toggleShard(shard)">
            <h2>
                  <span [ngClass]="{'open': shard.show}"><b>Shard: {{shard.name}}</b></span>
                  <div style="float:right" *ngIf="!shard.range || shard.state == 'inactive'"><a (click)="toggleRemoveShard(shard)"><span class="rem"></span></a></div>
              </h2>
          </a>
          <ul *ngIf="shard.showRemove">
              <li>
                <form class="delete-shard">
                      <p class="clearfix"><em>Are you sure you want to delete this shard?</em></p>
                      <p class="clearfix buttons">
                        <button class="submit" [ngClass]="{'success': shard.deleted}" (click)="deleteShard(shard)"><span>Delete Shard</span></button>
                        <button type="reset" class="reset" (click)="toggleRemoveShard(shard)"><span>Cancel</span></button>
                      </p>
                  </form>
            </li>
            </ul>
          <ul *ngIf="shard.show">
              <li>
                  <ul>
                      <li>
                          <dl class="clearfix">
                            <dt><span>state:</span></dt>
                            <dd>{{shard.state}}</dd>
                          </dl>
                      </li>
                      <li>
                      <dl class="clearfix">
                        <dt><span>range:</span></dt>
                        <dd>{{shard.range}}</dd>
                      </dl>
                          <br/>
                      </li>
                      <li>
                        <ul class="replica" *ngFor="let replica of shard.replicas">
                          <li>
                                  <h2>
                                    <a (click)="toggleReplica(replica)">
                                      <span class="openReplica" [ngClass]="{'open': replica.show}">Replica: {{replica.name}}</span>
                                    </a>
                                    <div style="float:right"><a (click)="toggleRemoveReplica(replica)"><span class="rem"></span></a></div>
                                 </h2>
                          </li>
                          <li>
                            <ul *ngIf="replica.showRemove">
                                <li>
                                    <form class="delete-replica">
                                      <p class="clearfix"><em>Are you sure you want to delete this replica?</em></p>
                                      <p class="clearfix buttons">
                                        <button class="submit" [ngClass]="{'success': replica.deleted}" (click)="deleteReplica(replica)"><span>Delete Replica</span></button>
                                        <button type="reset" class="reset" (click)="toggleRemoveReplica(replica)"><span>Cancel</span></button>
                                      </p>
                                    </form>
                                </li>
                            </ul>
                            <ul *ngIf="replica.show">
                                <li>
                                    <dl class="clearfix">
                                        <dt><span>core:</span></dt>
                                        <dd>{{replica.core}}</dd>
                                    </dl>
                                </li>
                                <li>
                                    <dl class="clearfix">
                                        <dt><span>base URL:</span></dt>
                                        <dd><a href="{{replica.base_url}}{{rootUrl}}">{{replica.base_url}}</a></dd>
                                    </dl>
                                </li>
                                <li>
                                    <dl class="clearfix">
                                        <dt><span>node name:</span></dt>
                                        <dd>{{replica.node_name}}</dd>
                                    </dl>
                                </li>
                                <li>
                                    <dl class="clearfix">
                                        <dt><span>state:</span></dt>
                                        <dd>{{replica.state}}</dd>
                                    </dl>
                                </li>
                                <li>
                                    <dl class="clearfix">
                                        <dt><span>leader:</span></dt>
                                        <dd class="ico" [ngClass]="{'ico-1' : replica.leader, 'ico-0' : !replica.leader}"><span></span></dd>
                                    </dl>
                                </li>
                            </ul>
                          </li>
                        </ul>
                      </li>
                      <li *ngIf="!shard.showAdd">
                          <span class="actions replica">
                            <button class="action" id="add-replica" (click)="toggleAddReplica(shard)"><span>add replica</span></button>
                          </span>
                      </li>
                  </ul>
                  <div class="action add-replica" *ngIf="shard.showAdd">
                    <form>
                      <p id="node-name" class="clearfix"><label for="node-name">Node:</label>
                      <select (ngModel)="shard.replicaNodeName" class="other">
                      	<option value="">No specified node</option>
			          	<option *ngFor="let node of nodes">{{node}}</option>
			          </select>
                          node: {{shard.replicaNodeName}}
                      </p>
                      <p class="clearfix note error" *ngIf="createReplicaMessage">
                        <span>{{createReplicaMessage}}</span>
                      </p>
                      <p class="clearfix buttons">
                        <button class="submit delete" [ngClass]="{'success': shard.replicaAdded}" (click)="addReplica(shard)"><span>Create Replica</span></button>
                        <button type="reset" class="reset" (click)="toggleAddReplica(shard)"><span>Cancel</span></button>
                      </p>
                        <p clas="clearfix">&nbsp;</p>
                    </form>
                  </div>
              </li>
          </ul>
        </div>
      </div>

    </div>

  </div>

  <div id="navigation" class="requires-core clearfix">
    <ul>
      <li *ngFor="let c of sharedService.collections" [ngClass]="{'current': collection == c}"><a [routerLink]="['/collections', c]">{{c}}</a></li>
    </ul>
  </div>

</div>
